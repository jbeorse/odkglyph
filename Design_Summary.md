# Details #

  * This summary will only go into adding a single image, for simplicity.

  * The first problem we had to solve to add images to odk collect was to read them from the XForms. We decided to add an img attribute to the label tag where the user would specify the image name. We chose an attribute because it was the least obtrusive way to add it (it broke XForms the least). This image would be stored in a specific directory structure (in this case "/sdcard/odk/images/[form-name]/", but this can be anything as long as the code that loads the images is adjusted properly). We chose this structure because it was backwards compatible with old forms.

  * To read that img attribute we had to change XFormParser.java in the javarosa core source. For images in questions we had to add code to the parseQuestionLabel method, and for answers we changed the parseItem method. In general, if you want to change how javarosa reads xforms you search this file for the code that parses the particular part of the XForm you wish to change. We added a hash table to read all attributes specified in a question label, so part of the framework is already there if you want to add more attributes to questions.

  * Once the attribute is read in by the XFormParser we needed somewhere to save it. This location is QuestionDef.java in the javarosa core library. We expanded this definition to include the hash table of image names and setter and getter methods for them.

  * That's it, you are done with javarosa at this point. We added a class to javarosa to allow us to associate captions with images in the same hash table, but if you are just trying to add a new item to XForms this is not necessary.

  * To read this in ODK Collect we had to do separate things for questions and answers. For questions we added a method, AddQuestionImage, to go with AddQuestionText etc. For answers we changed the widgets, SelectOneWidget and SelectMultiWidget, to add the images right after they add their text. In both cases, the image is not read straight from the QuestionDef but instead from the PrompElement, so we had to change this file as well. This is pretty basic though, it just acts as an intermediary between the QuestionDef and the View or Widget.

  * At this point you are able to show a single image. To add captions we had to create a new class in javarosa so that we could associate a caption with an image in the hash table. This is called ImageItem.java and it just stores the image's ID, path, and caption (it only works with multi image).  Tthe logic for multi images is bit more complex throughout, but this is the general idea. It is based on the itext framework already included in javarosa. This process could be followed loosely to add audio to questions or answers, or anything else you might want. More detail about the exact changes made can be found in the changes document.

  * **NOTE** In the presentation of we were asked if you could have a question be completely made of images with no text. We answered yes, as long as you just left the label blank, but we have investigated this further and this is not the case. While it will work in showing you the question or answer with no text, the missing label causes other problems, like identifying which answers go to which questions. A fix for this would be to add another attribute to label to specify to include the text or not. You would follow the above procedure to read it in (or follow how we add captions) and then just case on that boolean when adding the text view. We apologize for the misinformation.